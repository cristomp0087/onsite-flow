<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>OnSite Flow</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">

  <!-- Leaflet CSS (obrigatÃ³rio) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Seu CSS (use caminho RELATIVO) -->
  <link rel="stylesheet" href="./css/field.css" />
</head>

<header class="field-header" aria-label="OnSite Flow">
  <div class="brand">
    <img class="brand-logo" src="./assets/logo-onsite-club-02.png" alt="OnSite Club" />
    <div class="brand-meta">
      <div class="brand-title">OnSite Flow</div>
      <div class="brand-subtitle">Ponto por geofencing</div>
    </div>
  </div>
</header>

<body>
  <div id="app" class="app">

    <!-- DASHBOARD -->
    <main id="dashboard-screen" class="tab-screen active" aria-label="InÃ­cio">
      <section class="card card-status">
        <div id="gps-status-bar" class="gps-bar" role="status" aria-live="polite">
          ğŸ“¡ Buscando SatÃ©lites...
        </div>

        <div class="status-content">
          <p class="status-title" id="status-label">Status Atual</p>
          <div class="status-time" id="status-timer">--:--</div>
          <div class="status-location" id="status-loc"><span>âšª</span> NÃ£o trabalhando</div>
        </div>
      </section>

      <section class="action-grid" aria-label="AÃ§Ãµes">
        <button id="btn-main-action" class="btn btn-big btn-primary" disabled>
          <span class="btn-icon" aria-hidden="true">ğŸ“</span>
          <span id="btn-main-text">Aguarde GPS</span>
        </button>

        <button id="btn-visit-action" class="btn btn-big btn-ghost" disabled>
          <span class="btn-icon" aria-hidden="true">ğŸ‘ï¸</span>
          <span>Visita</span>
        </button>
      </section>

      <section aria-label="HistÃ³rico">
        <header class="section-head">
          <h2 class="section-title">HistÃ³rico Recente</h2>
          <p class="section-subtitle">Ãšltimos registros deste dispositivo.</p>
        </header>

        <div id="report-list" class="report-list">
          <div class="empty-state">
            <div class="spinner" aria-hidden="true"></div>
            <p>Carregando...</p>
          </div>
        </div>
      </section>
    </main>

    <!-- MAPA (ABA) -->
    <main id="map-screen" class="tab-screen" aria-label="Locais">
      <div class="map-overlay">
        <div class="map-overlay-head">
          <h2 class="map-title">Gerenciar Locais</h2>
          <p class="map-subtitle">Cadastre obras por endereÃ§o, clicando no mapa ou usando sua posiÃ§Ã£o.</p>
        </div>

        <!-- Busca por endereÃ§o -->
        <div class="map-tools">
          <label class="sr-only" for="site-search">Buscar endereÃ§o</label>
          <input
            id="site-search"
            class="input"
            type="search"
            placeholder="Buscar endereÃ§o (ex: 100 Queen St, Ottawa)"
            autocomplete="street-address"
          />
          <div id="site-search-results" class="search-results" aria-live="polite"></div>
        </div>

        <!-- AÃ§Ãµes de cadastro -->
        <div class="map-actions">
          <button id="btn-pick-on-map" class="btn btn-ghost btn-wide" type="button">
            ğŸ“ Marcar no mapa
          </button>

          <button id="btn-use-gps" class="btn btn-ghost btn-wide" type="button">
            ğŸ›°ï¸ Usar minha posiÃ§Ã£o
          </button>

          <button id="btn-save-site" class="btn btn-primary btn-wide" type="button" disabled>
            â• Salvar local
          </button>
        </div>

        <p id="pick-hint" class="map-hint" style="display:none;">
          Toque/clique no mapa para escolher o ponto. VocÃª pode arrastar o pin.
        </p>

        <div id="draft-info" class="draft-info" style="display:none;">
          <span class="draft-badge">PONTO SELECIONADO</span>
          <span id="draft-coords" class="draft-coords">â€”</span>
        </div>
      </div>

      <div id="map" class="map" aria-label="Mapa"></div>
    </main>

    <!-- ALERTA GEOFENCE -->
    <div id="geofence-alert" class="geo-alert" role="dialog" aria-modal="true" aria-label="Chegada detectada">
      <div class="geo-alert-body">
        <h3 class="geo-title">ğŸ“ VocÃª chegou!</h3>
        <p id="geo-msg" class="geo-msg">Detectamos entrada em Obra</p>
        <div class="geo-actions">
          <button id="btn-geo-visit" class="btn btn-ghost">Visita</button>
          <button id="btn-geo-work" class="btn btn-success">Trabalhar</button>
        </div>
      </div>
    </div>

 <!-- NAV -->
<nav class="bottom-nav" aria-label="NavegaÃ§Ã£o">
  <button class="nav-item active" id="tab-dash" type="button">
    <span class="nav-icon" aria-hidden="true">ğŸ </span>
    <span class="nav-label">InÃ­cio</span>
  </button>

  <button class="nav-item" id="tab-map" type="button">
    <span class="nav-icon" aria-hidden="true">ğŸ—ºï¸</span>
    <span class="nav-label">Locais</span>
  </button>
</nav>

  </div>

  <!-- Libs -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Field App (novo entrypoint) -->
  <script type="module" src="./src/fieldApp.js"></script>



  <script>
  // Console no celular: sÃ³ liga quando vocÃª abrir com ?debug=1
  if (new URLSearchParams(location.search).has("debug")) {
    var s = document.createElement("script");
    s.src = "https://cdn.jsdelivr.net/npm/eruda";
    s.onload = function(){ eruda.init(); };
    document.body.appendChild(s);
  }
</script>


</body>
</html>
